/*
  backgrid-paginator
  http://github.com/wyuenho/backgrid

  Copyright (c) 2012 Jimmy Yuen Ho Wong
  Licensed under the MIT @license.
*/
(function(e,a,t,i){var s=i.PageHandle=t.View.extend({tagName:"li",events:{"click a":"loadPage"},initialize:function(e){this.label=e.label,this.page=e.page},render:function(){var a=e("<a>"+this.label+"</a>",{href:"#",title:"Page "+this.label});return this.$el.append(a),this},loadPage:function(e){e.preventDefault(),this.$el.hasClass("active")||this.$el.hasClass("disabled")||this.collection.goTo(this.page)}});i.Paginator=i.Footer.extend({className:"paginator",windowSize:10,hasFastForward:!0,initialize:function(e){i.Footer.prototype.initialize.apply(this,arguments),e=e?a.clone(e):{},this.collection.on("reset",this.refresh,this),this.windowSize=e.windowSize||this.windowSize,this.hasFastForward=e.hasFastForward||this.hasFastForward,this.handles=[]},dispose:function(){this.parent&&this.parent.off&&this.parent.off(null,null,this),this.columns.off(null,null,this);for(var e=null,a=0;this.handles.length>a;a++)e=this.handles[a],e.off(null,null,this),e.dispose();return t.View.prototype.dispose.apply(this,arguments)},refresh:function(){for(var e=this.$el.find("ul"),a=0;this.handles.length>a;a++)this.handles[a].remove();this.handles=[];var t=this.collection,i=t.totalPages,n=Math.floor((t.currentPage-1)/this.windowSize)*this.windowSize,l=n+this.windowSize;l=i>=l?l:i;for(var a=n;l>a;a++){var r=new s({label:a+1,page:a+1,className:a+1===t.currentPage?"active":void 0,collection:t});this.handles.push(r),e.append(r.render().$el)}this.renderFastForward()},renderFastForward:function(){if(this.hasFastForward){var e=this.$el.find("ul"),a=this.collection,t=new s({label:"《",page:1,className:a.currentPage>a.firstPage?void 0:"disabled",collection:a}),i=new s({label:"〈",page:a.currentPage-1,className:a.currentPage>a.firstPage?void 0:"disabled",collection:a}),n=new s({label:"〉",page:a.currentPage+1,className:a.currentPage<a.totalPages?void 0:"disabled",collection:a}),l=new s({label:"》",page:a.totalPages,className:a.currentPage<a.totalPages?void 0:"disabled",collection:a});this.handles.unshift(i),this.handles.unshift(t),this.handles.push(n),this.handles.push(l),e.prepend(i.render().$el),e.prepend(t.render().$el),e.append(n.render().$el),e.append(l.render().$el)}},render:function(){var t=a.reduce(this.columns.pluck("renderable"),function(e,a){return a?e+1:0},0);return this.$el.append(e("<tr><td colspan='"+t+"'><ul></ul></td></tr>")),this.refresh(),this}})})(jQuery,_,Backbone,Backgrid);