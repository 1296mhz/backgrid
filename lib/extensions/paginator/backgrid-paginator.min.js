/*
  backgrid-paginator
  http://github.com/wyuenho/backgrid

  Copyright (c) 2012 Jimmy Yuen Ho Wong
  Licensed under the MIT @license.
*/
(function(e,t,a,i){i.Extension.Paginator=i.Footer.extend({className:"paginator",windowSize:10,hasFastForward:!0,template:t.template('<tr><td colspan="<%= colspan %>"><ul><% _.each(handles, function (handle) { %><li <% if (handle.className) { %>class="<%= handle.className %>"<% } %>><a href="#" <% if (handle.title) {%> title="<%= handle.title %>"<% } %>><%= handle.label %></a></li><% }); %></ul></td></tr>'),events:{"click a":"changePage"},initialize:function(){i.Footer.prototype.initialize.apply(this,arguments),this.collection.on("reset",this.render,this)},dispose:function(){return this.parent&&this.parent.off&&this.parent.off(null,null,this),this.columns.off(null,null,this),a.View.prototype.dispose.apply(this,arguments)},changePage:function(e){e.preventDefault();var t=this.$el.find("a"),a=t.index(e.target),i=t.size();if(this.hasFastForward)switch(a){case 0:return this.collection.getFirstPage(),void 0;case 1:return this.collection.getPreviousPage(),void 0;case i-2:return this.collection.getNextPage(),void 0;case i-1:return this.collection.getLastPage(),void 0;default:a-=2}var s=this.collection.state,l=0===s.firstPage?s.currentPage:s.currentPage-1,n=Math.floor(l/this.windowSize)*this.windowSize,o=n+a;this.collection.getPage(0===s.firstPage?o:o+1)},makeHandles:function(){var e=[],t=this.collection,a=t.state,i=0===a.firstPage?a.lastPage:a.lastPage-1,s=0===a.firstPage?a.currentPage:a.currentPage-1,l=Math.floor(s/this.windowSize)*this.windowSize,n=l+this.windowSize;n=i>=n?n:i+1;for(var o=l;n>o;o++)e.push({label:o+1,title:"No. "+(o+1),className:s===o?"active":void 0});return this.hasFastForward&&(e.unshift({label:"〈",className:0>s-1?"disabled":void 0}),e.unshift({label:"《",className:0>s-1?"disabled":void 0}),e.push({label:"〉",className:s+1>i?"disabled":void 0}),e.push({label:"》",className:s+1>i?"disabled":void 0})),e},render:function(){this.$el.empty();var a=t.reduce(this.columns.pluck("renderable"),function(e,t){return t?e+1:0},0);return this.$el.append(e(this.template({colspan:a,handles:this.makeHandles()}))),this}})})(jQuery,_,Backbone,Backgrid);