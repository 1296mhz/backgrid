/*
  backgrid-paginator
  http://github.com/wyuenho/backgrid

  Copyright (c) 2012 Jimmy Yuen Ho Wong
  Licensed under the MIT @license.
*/
(function(e,t,i,s){var a=s.PaginatorItem=i.View.extend({tagName:"li",events:{"click a":"loadPage"},initialize:function(e){this.label=e.label,this.page=e.page,this.hasAnchor=e.hasAnchor!==void 0?e.hasAnchor:!0},render:function(){var t=e("<a>"+this.label+"</a>",{href:"#",title:"Page "+this.label});return this.$el.append(t),this},loadPage:function(e){e.preventDefault(),this.$el.hasClass("active")||this.$el.hasClass("disabled")||this.collection.goTo(this.page)}});s.Paginator=s.Footer.extend({className:"paginator",windowSize:10,hasFastForward:!0,initialize:function(e){s.Footer.prototype.initialize.apply(this,arguments),e=e?t.clone(e):{},this.parent=e.parent,this.columns=e.columns,this.columns instanceof i.Collection||(this.columns=new s.Columns(this.columns)),this.collection.on("reset",this.refresh,this),this.windowSize=e.windowSize||this.windowSize,this.hasFastForward=e.hasFastForward||this.hasFastForward,this.items=[]},dispose:function(){i.View.prototype.dispose.apply(this,arguments),this.parent&&this.parent.off&&this.parent.off(null,null,this),this.columns.off(null,null,this);for(var e=null,t=0;this.items.length>t;t++)e=this.items[t],e.off(null,null,this),e.dispose();return this},refresh:function(){for(var e=this.$el.find("ul"),t=0;this.items.length>t;t++)this.items[t].remove();this.items=[];var i=this.collection,s=i.totalPages,n=Math.floor((i.currentPage-1)/this.windowSize)*this.windowSize,l=n+this.windowSize;l=s>=l?l:s;for(var t=n;l>t;t++){var r=new a({label:t+1,page:t+1,className:t+1===i.currentPage?"active":void 0,collection:i});this.items.push(r),e.append(r.render().$el)}this.renderFastForward()},renderFastForward:function(){if(this.hasFastForward){var e=this.$el.find("ul"),t=this.collection,i=new a({label:"<<",page:1,className:t.currentPage>t.firstPage?void 0:"disabled",collection:t}),s=new a({label:"<",page:t.currentPage-1,className:t.currentPage>t.firstPage?void 0:"disabled",collection:t}),n=new a({label:">",page:t.currentPage+1,className:t.totalPages>t.currentPage?void 0:"disabled",collection:t}),l=new a({label:">>",page:t.totalPages,className:t.totalPages>t.currentPage?void 0:"disabled",collection:t});this.items.unshift(s),this.items.unshift(i),this.items.push(n),this.items.push(l),e.prepend(s.render().$el),e.prepend(i.render().$el),e.append(n.render().$el),e.append(l.render().$el)}},render:function(){var i=t.reduce(this.columns.pluck("renderable"),function(e,t){return t?e+1:0},0);return this.$el.append(e("<tr><td colspan='"+i+"'><ul></ul></td></tr>")),this.refresh(),this}})})(jQuery,_,Backbone,Backgrid);