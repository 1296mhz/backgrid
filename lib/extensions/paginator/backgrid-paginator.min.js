/*
  backgrid-paginator
  http://github.com/wyuenho/backgrid

  Copyright (c) 2013 Jimmy Yuen Ho Wong
  Licensed under the MIT @license.
*/
(function(e,t,i,a){a.Extension.Paginator=a.Footer.extend({className:"paginator",windowSize:10,fastForwardHandleLabels:{first:"《",prev:"〈",next:"〉",last:"》"},template:t.template('<tr><td colspan="<%= colspan %>"><ul><% _.each(handles, function (handle) { %><li <% if (handle.className) { %>class="<%= handle.className %>"<% } %>><a href="#" <% if (handle.title) {%> title="<%= handle.title %>"<% } %>><%= handle.label %></a></li><% }); %></ul></td></tr>'),events:{"click a":"changePage"},initialize:function(){a.Footer.prototype.initialize.apply(this,arguments),this.listenTo(this.collection,"reset",this.render)},changePage:function(t){t.preventDefault();var i=this.$el.find("a"),a=e(t.target).text(),s=this.fastForwardHandleLabels;if(s)switch(a){case s.first:return this.collection.getFirstPage(),void 0;case s.prev:return this.collection.getPreviousPage(),void 0;case s.next:return this.collection.getNextPage(),void 0;case s.last:return this.collection.getLastPage(),void 0}var l=i.index(t.target),n=this.collection.state,r=0===n.firstPage?n.currentPage:n.currentPage-1,o=Math.floor(r/this.windowSize)*this.windowSize,d=o+l;this.collection.getPage(0===n.firstPage?d:d+1)},makeHandles:function(){var e=[],t=this.collection,i=t.state,a=0===i.firstPage?i.lastPage:i.lastPage-1,s=0===i.firstPage?i.currentPage:i.currentPage-1,l=Math.floor(s/this.windowSize)*this.windowSize,n=l+this.windowSize;if(n=a>=n?n:a+1,"infinite"!==t.mode)for(var r=l;n>r;r++)e.push({label:r+1,title:"No. "+(r+1),className:s===r?"active":void 0});var o=this.fastForwardHandleLabels;if(o){var d,c=this.collection.mode,h=this.collection.links;d="infinite"==c?{first:h&&h.first?void 0:"disabled",prev:h&&h.prev?void 0:"disabled",next:h&&h.next?void 0:"disabled",last:h&&h.last?void 0:"disabled"}:{first:0>s-1?"disabled":void 0,prev:0>s-1?"disabled":void 0,next:s+1>a?"disabled":void 0,last:s+1>a?"disabled":void 0},e.unshift({label:o.prev,className:d.prev}),e.unshift({label:o.first,className:d.first}),e.push({label:o.next,className:d.next}),e.push({label:o.last,className:d.last})}return e},render:function(){this.$el.empty();var i=t.reduce(this.columns.pluck("renderable"),function(e,t){return t?e+1:0},0);return this.$el.append(e(this.template({colspan:i,handles:this.makeHandles()}))),this}})})(jQuery,_,Backbone,Backgrid);