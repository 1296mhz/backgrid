/*
  backgrid-paginator
  http://github.com/wyuenho/backgrid

  Copyright (c) 2013 Jimmy Yuen Ho Wong and contributors
  Licensed under the MIT @license.
*/
(function(e,t,s){"use strict";s.Extension.Paginator=s.View.extend({className:"backgrid-paginator",windowSize:10,fastForwardHandleLabels:{first:"《",prev:"〈",next:"〉",last:"》"},template:e.template('<ul><% _.each(handles, function (handle) { %><li <% if (handle.className) { %>class="<%= handle.className %>"<% } %>><a href="#" <% if (handle.title) {%> title="<%= handle.title %>"<% } %>><%= handle.label %></a></li><% }); %></ul>'),events:{"click a":"changePage"},initialize:function(e){s.requireOptions(e,["columns","collection"]),this.columns=e.columns,this.columns instanceof t.Collection||(this.columns=new s.Columns(this.columns));var i=this.columns;this.listenTo(i,"add",this.render),this.listenTo(i,"remove",this.render),this.listenTo(i,"change:renderable",this.render);var a=this.collection,n=a.fullCollection;n?(this.listenTo(n,"add",this.render),this.listenTo(n,"remove",this.render),this.listenTo(n,"reset",this.render)):(this.listenTo(a,"add",this.render),this.listenTo(a,"remove",this.render),this.listenTo(a,"reset",this.render))},changePage:function(e){e.preventDefault();var t=e.target,s=t.textContent||t.innerText,i=this.fastForwardHandleLabels,a=this.collection;if(i)switch(s){case i.first:return a.getFirstPage(),void 0;case i.prev:return a.hasPrevious()&&a.getPreviousPage(),void 0;case i.next:return a.hasNext()&&a.getNextPage(),void 0;case i.last:return a.getLastPage(),void 0}var n=a.state,l=1*s;a.getPage(0===n.firstPage?l-1:l)},makeHandles:function(){var e=[],t=this.collection,s=t.state,i=s.lastPage?s.lastPage:s.firstPage;i=0===s.firstPage?i:i-1;var a=0===s.firstPage?s.currentPage:s.currentPage-1,n=Math.floor(a/this.windowSize)*this.windowSize,l=n+this.windowSize;if(l=i>=l?l:i+1,"infinite"!==t.mode)for(var r=n;l>r;r++)e.push({label:r+1,title:"No. "+(r+1),className:a===r?"active":void 0});var o=this.fastForwardHandleLabels;return o&&(o.prev&&e.unshift({label:o.prev,className:t.hasPrevious()?void 0:"disabled"}),o.first&&e.unshift({label:o.first,className:t.hasPrevious()?void 0:"disabled"}),o.next&&e.push({label:o.next,className:t.hasNext()?void 0:"disabled"}),o.last&&e.push({label:o.last,className:t.hasNext()?void 0:"disabled"})),e},render:function(){return this.empty(),this.el.innerHTML=this.template({handles:this.makeHandles()}),this.delegateEvents(),this}})})(_,Backbone,Backgrid);