/*
  backgrid-paginator
  http://github.com/wyuenho/backgrid

  Copyright (c) 2013 Jimmy Yuen Ho Wong and contributors
  Licensed under the MIT @license.
*/
(function(e,t,a){"use strict";a.Extension.Paginator=a.View.extend({className:"backgrid-paginator",windowSize:10,fastForwardHandleLabels:{first:"《",prev:"〈",next:"〉",last:"》"},template:e.template('<ul><% _.each(handles, function (handle) { %><li <% if (handle.className) { %>class="<%= handle.className %>"<% } %>><a href="#" <% if (handle.title) {%> title="<%= handle.title %>"<% } %>><%= handle.label %></a></li><% }); %></ul>'),events:{"click a":"changePage"},initialize:function(e){a.requireOptions(e,["collection"]);var t=this.collection,i=t.fullCollection;i?(this.listenTo(i,"add",this.render),this.listenTo(i,"remove",this.render),this.listenTo(i,"reset",this.render)):(this.listenTo(t,"add",this.render),this.listenTo(t,"remove",this.render),this.listenTo(t,"reset",this.render))},changePage:function(e){e.preventDefault();var t=e.target,a=t.parentNode;if(!a.classList.contains("active")&&a.classList.contains("disabled")){var i=t.textContent||t.innerText,s=this.fastForwardHandleLabels,n=this.collection;if(s)switch(i){case s.first:return n.getFirstPage(),void 0;case s.prev:return n.hasPrevious()&&n.getPreviousPage(),void 0;case s.next:return n.hasNext()&&n.getNextPage(),void 0;case s.last:return n.getLastPage(),void 0}var l=n.state,r=+i;n.getPage(l.firstPage===0?r-1:r)}},makeHandles:function(){var e=[],t=this.collection,a=t.state,i=a.firstPage,s=+a.lastPage;s=Math.max(0,i?s-1:s);var n=Math.max(a.currentPage,a.firstPage);n=i?n-1:n;var l=Math.floor(n/this.windowSize)*this.windowSize,r=Math.min(s+1,l+this.windowSize);if(t.mode!=="infinite")for(var o=l;r>o;o++)e.push({label:o+1,title:"No. "+(o+1),className:n===o?"active":void 0});var d=this.fastForwardHandleLabels;return d&&(d.prev&&e.unshift({label:d.prev,className:t.hasPrevious()?void 0:"disabled"}),d.first&&e.unshift({label:d.first,className:t.hasPrevious()?void 0:"disabled"}),d.next&&e.push({label:d.next,className:t.hasNext()?void 0:"disabled"}),d.last&&e.push({label:d.last,className:t.hasNext()?void 0:"disabled"})),e},render:function(){return this.empty(),this.el.innerHTML=this.template({handles:this.makeHandles()}),this.delegateEvents(),this}})})(_,Backbone,Backgrid);