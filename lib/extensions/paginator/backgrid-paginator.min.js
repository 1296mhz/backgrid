/*
  backgrid-paginator
  http://github.com/wyuenho/backgrid

  Copyright (c) 2013 Jimmy Yuen Ho Wong and contributors
  Licensed under the MIT @license.
*/
!function(t,e,i){"use strict";var a=i.Extension.PageHandle=e.View.extend({tagName:"li",events:{"click a":"changePage"},title:t.template("Page <%- label %>"),isRewind:!1,isBack:!1,isForward:!1,isFastForward:!1,initialize:function(i){e.View.prototype.initialize.apply(this,arguments);var a=this.collection,s=a.state,l=s.currentPage,n=s.firstPage,r=s.lastPage;t.extend(this,t.pick(i,["isRewind","isBack","isForward","isFastForward"]));var o;this.isRewind?o=n:this.isBack?o=Math.max(n,l-1):this.isForward?o=Math.min(r,l+1):this.isFastForward?o=r:(o=+i.pageIndex,o=n?o+1:o),this.pageIndex=o,(this.isRewind||this.isBack)&&l==n||(this.isForward||this.isFastForward)&&l==r?this.$el.addClass("disabled"):this.isRewind||this.isBack||this.isForward||this.isFastForward||l!=o||this.$el.addClass("active"),this.label=(i.label||(n?o:o+1))+"";var h=i.title||this.title;this.title=t.isFunction(h)?h({label:this.label}):h},render:function(){this.$el.empty();var t=document.createElement("a");return t.href="#",this.title&&(t.title=this.title),t.innerHTML=this.label,this.el.appendChild(t),this.delegateEvents(),this},changePage:function(t){t.preventDefault();var e=this.$el;return e.hasClass("active")||e.hasClass("disabled")||this.collection.getPage(this.pageIndex),this}});i.Extension.Paginator=e.View.extend({className:"backgrid-paginator",windowSize:10,controls:{rewind:{label:"《",title:"First"},back:{label:"〈",title:"Previous"},forward:{label:"〉",title:"Next"},fastForward:{label:"》",title:"Last"}},pageHandle:a,goBackFirstOnSort:!0,initialize:function(t){i.requireOptions(t,["collection"]),this.controls=t.controls||this.controls,this.pageHandle=t.pageHandle||this.pageHandle;var e=this.collection;this.listenTo(e,"add",this.render),this.listenTo(e,"remove",this.render),this.listenTo(e,"reset",this.render),(t.goBackFirstOnSort||this.goBackFirstOnSort)&&e.fullCollection&&this.listenTo(e.fullCollection,"sort",function(){e.getFirstPage()})},_calculateWindow:function(){var t=this.collection,e=t.state,i=e.firstPage,a=+e.lastPage;a=Math.max(0,i?a-1:a);var s=Math.max(e.currentPage,e.firstPage);s=i?s-1:s;var l=Math.floor(s/this.windowSize)*this.windowSize,n=Math.min(a+1,l+this.windowSize);return[l,n]},makeHandles:function(){for(var e=[],i=this.collection,s=this._calculateWindow(),l=s[0],n=s[1],r=l;n>r;r++)e.push(new a({collection:i,pageIndex:r}));var o=this.controls;return t.each(["back","rewind","forward","fastForward"],function(t){var s=o[t];if(s){var l={collection:i,title:s.title,label:s.label};l["is"+t.slice(0,1).toUpperCase()+t.slice(1)]=!0;var n=new a(l);"rewind"==t||"back"==t?e.unshift(n):e.push(n)}}),e},render:function(){if(this.$el.empty(),this.handles)for(var t=0,e=this.handles.length;e>t;t++)this.handles[t].remove();for(var i=this.handles=this.makeHandles(),a=document.createElement("ul"),t=0;t<i.length;t++)a.appendChild(i[t].render().el);return this.el.appendChild(a),this}})}(_,Backbone,Backgrid);