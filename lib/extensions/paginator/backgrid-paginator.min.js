/*
  backgrid-paginator
  http://github.com/wyuenho/backgrid

  Copyright (c) 2012 Jimmy Yuen Ho Wong
  Licensed under the MIT @license.
*/
(function(e,t,a,i){var s=i.Extension.PageHandle=a.View.extend({tagName:"li",events:{"click a":"loadPage"},initialize:function(e){this.label=e.label,this.page=e.page},render:function(){var t=e("<a>"+this.label+"</a>",{href:"#",title:"Page "+this.label});return this.$el.append(t),this},loadPage:function(e){e.preventDefault(),this.$el.hasClass("active")||this.$el.hasClass("disabled")||this.collection.goTo(this.page)}});i.Extension.Paginator=i.Footer.extend({className:"paginator",windowSize:10,hasFastForward:!0,initialize:function(e){i.Footer.prototype.initialize.apply(this,arguments),e=e?t.clone(e):{},this.collection.on("reset",this.refresh,this),this.windowSize=e.windowSize||this.windowSize,this.hasFastForward=e.hasFastForward||this.hasFastForward,this.handles=[]},dispose:function(){this.parent&&this.parent.off&&this.parent.off(null,null,this),this.columns.off(null,null,this);for(var e=null,t=0;this.handles.length>t;t++)e=this.handles[t],e.off(null,null,this),e.dispose();return a.View.prototype.dispose.apply(this,arguments)},refresh:function(){for(var e=this.$el.find("ul"),t=0;this.handles.length>t;t++)this.handles[t].remove();this.handles=[];var a=this.collection,i=a.totalPages,n=Math.floor((a.currentPage-1)/this.windowSize)*this.windowSize,l=n+this.windowSize;l=i>=l?l:i;for(var t=n;l>t;t++){var r=new s({label:t+1,page:t+1,className:t+1===a.currentPage?"active":void 0,collection:a});this.handles.push(r),e.append(r.render().$el)}this.renderFastForward()},renderFastForward:function(){if(this.hasFastForward){var e=this.$el.find("ul"),t=this.collection,a=new s({label:"《",page:1,className:t.currentPage>t.firstPage?void 0:"disabled",collection:t}),i=new s({label:"〈",page:t.currentPage-1,className:t.currentPage>t.firstPage?void 0:"disabled",collection:t}),n=new s({label:"〉",page:t.currentPage+1,className:t.currentPage<t.totalPages?void 0:"disabled",collection:t}),l=new s({label:"》",page:t.totalPages,className:t.currentPage<t.totalPages?void 0:"disabled",collection:t});this.handles.unshift(i),this.handles.unshift(a),this.handles.push(n),this.handles.push(l),e.prepend(i.render().$el),e.prepend(a.render().$el),e.append(n.render().$el),e.append(l.render().$el)}},render:function(){var a=t.reduce(this.columns.pluck("renderable"),function(e,t){return t?e+1:0},0);return this.$el.append(e("<tr><td colspan='"+a+"'><ul></ul></td></tr>")),this.refresh(),this}})})(jQuery,_,Backbone,Backgrid);