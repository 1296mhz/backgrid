/*
  backgrid-select-all
  http://github.com/wyuenho/backgrid

  Copyright (c) 2013 Jimmy Yuen Ho Wong and contributors
  Licensed under the MIT @license.
*/
(function(e,t,i){var n=i.Extension.SelectRowCell=i.View.extend({className:"select-row-cell",tagName:"td",events:{"keydown input[type=checkbox]":"onKeydown","change input[type=checkbox]":"onChange","click input[type=checkbox]":"enterEditMode"},initialize:function(e){i.requireOptions(e,["model","column"]),this.column=e.column,this.column instanceof i.Column||(this.column=new i.Column(this.column)),this.listenTo(this.model,"backgrid:select",function(e,t){this.checkbox().checked=t})},checkbox:function(){return this.el.querySelector("input[type=checkbox]")},enterEditMode:function(){this.checkbox().focus()},exitEditMode:function(){this.checkbox().blur()},onKeydown:function(e){var t=new i.Command(e);return t.passThru()?!0:(t.cancel()?(e.stopPropagation(),this.checkbox().blur()):(t.save()||t.moveLeft()||t.moveRight()||t.moveUp()||t.moveDown())&&(e.preventDefault(),e.stopPropagation(),this.model.trigger("backgrid:edited",this.model,this.column,t)),void 0)},onChange:function(e){this.model.trigger("backgrid:selected",this.model,e.target.checked)},render:function(){return this.empty().el.innerHTML='<input tabindex="-1" type="checkbox" />',this.delegateEvents(),this}}),c=i.Extension.SelectAllHeaderCell=n.extend({className:"select-all-header-cell",tagName:"th",initialize:function(e){i.requireOptions(e,["column","collection"]),this.column=e.column,this.column instanceof i.Column||(this.column=new i.Column(this.column));var t=this.collection,n=this.selectedModels={};this.listenTo(t,"backgrid:selected",function(e,t){t?n[e.id||e.cid]=e:(delete n[e.id||e.cid],this.checkbox().checked=!1)}),this.listenTo(t,"remove",function(e){delete n[e.cid]}),this.listenTo(t,"backgrid:refresh",function(){this.checkbox().checked=!1;for(var e=0;e<t.length;e++){var i=t.at(e);n[i.id||i.cid]&&i.trigger("backgrid:select",i,!0)}})},onChange:function(e){var t=e.target.checked,i=this.collection;i.each(function(e){e.trigger("backgrid:select",e,t)})}});i.Grid.prototype.getSelectedModels=function(){for(var e,t=this.header.row.cells,i=0,n=t.length;n>i;i++){var o=t[i];if(o instanceof c){e=o;break}}var l=[];if(e)for(var s in e.selectedModels)l.push(this.collection.get(s));return l}})(_,Backbone,Backgrid);